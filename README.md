# Bilibili è§†é¢‘ä¸Šä¼ åç«¯ç³»ç»Ÿ

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Bç«™è§†é¢‘è‡ªåŠ¨åŒ–å¤„ç†å’Œä¸Šä¼ ç³»ç»Ÿï¼Œæ”¯æŒè§†é¢‘ä¸‹è½½ã€å­—å¹•ç”Ÿæˆ/ç¿»è¯‘ã€å…ƒæ•°æ®ç”Ÿæˆå’Œè‡ªåŠ¨ä¸Šä¼ ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. è§†é¢‘å¤„ç†ä»»åŠ¡é“¾
- âœ… **è§†é¢‘ä¸‹è½½** - ä»å„å¤§å¹³å°ä¸‹è½½è§†é¢‘
- âœ… **å­—å¹•ç”Ÿæˆ** - ä½¿ç”¨ Whisper AI è‡ªåŠ¨ç”Ÿæˆå­—å¹•
- âœ… **å­—å¹•ç¿»è¯‘** - æ”¯æŒç™¾åº¦ç¿»è¯‘å’Œ DeepSeek ç¿»è¯‘
- âœ… **å…ƒæ•°æ®ç”Ÿæˆ** - AI ç”Ÿæˆè§†é¢‘æ ‡é¢˜ã€æè¿°ã€æ ‡ç­¾
- âœ… **ä¸Šä¼ åˆ° Bç«™** - è‡ªåŠ¨ä¸Šä¼ è§†é¢‘å’Œå­—å¹•
- âœ… **ä»»åŠ¡æ­¥éª¤è¿½è¸ª** - å®æ—¶è¿½è¸ªæ¯ä¸ªæ­¥éª¤çš„çŠ¶æ€

### 2. è§†é¢‘è¯¦æƒ…å’Œç®¡ç†
- âœ… **è§†é¢‘åˆ—è¡¨** - æŸ¥çœ‹æ‰€æœ‰å¤„ç†çš„è§†é¢‘
- âœ… **è§†é¢‘è¯¦æƒ…é¡µ** - æŸ¥çœ‹å®Œæ•´çš„è§†é¢‘ä¿¡æ¯å’Œå¤„ç†çŠ¶æ€
- âœ… **ä»»åŠ¡æ­¥éª¤å¯è§†åŒ–** - 6æ­¥å¤„ç†æµç¨‹çš„çŠ¶æ€å±•ç¤º
- âœ… **å•æ­¥é‡è¯•** - æ”¯æŒé‡æ–°è¿è¡Œå¤±è´¥çš„æŸä¸ªæ­¥éª¤
- âœ… **è¿›åº¦è¿½è¸ª** - å®æ—¶è¿›åº¦ç™¾åˆ†æ¯”å’Œæ—¶é•¿ç»Ÿè®¡
- âœ… **æ–‡ä»¶ç®¡ç†** - æŸ¥çœ‹å’Œä¸‹è½½ç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶

### 3. Bç«™è´¦å·è®¤è¯
- âœ… **æ‰«ç ç™»å½•** - æ”¯æŒ Bç«™ TV æ‰«ç ç™»å½•
- âœ… **QR ç å±•ç¤º** - åç«¯ç”Ÿæˆ PNG æ ¼å¼äºŒç»´ç 
- âœ… **è‡ªåŠ¨è½®è¯¢** - å‰ç«¯è‡ªåŠ¨æ£€æµ‹ç™»å½•çŠ¶æ€
- âœ… **ç”¨æˆ·ä¿¡æ¯** - è·å–å¹¶æ˜¾ç¤ºç”¨æˆ·åå’Œå¤´åƒ
- âœ… **ç™»å½•æŒä¹…åŒ–** - Token å’Œ Cookie è‡ªåŠ¨ä¿å­˜
- âœ… **çŠ¶æ€æ£€æŸ¥** - è‡ªåŠ¨æ£€æŸ¥ç™»å½•çŠ¶æ€




---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯æ ˆ
- **è¯­è¨€**: Go 1.x
- **Web æ¡†æ¶**: Gin
- **ORM**: GORM
- **æ•°æ®åº“**: MySQL 8.0+ / PostgreSQL / SQLite (å¼€å‘ç¯å¢ƒ)
- **æ–‡ä»¶å­˜å‚¨**: è…¾è®¯äº‘ COS
- **ä¾èµ–æ³¨å…¥**: Uber FX
- **é…ç½®ç®¡ç†**: TOML

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Next.js 15.5.4
- **è¯­è¨€**: TypeScript 5
- **UI åº“**: React 18 + Tailwind CSS
- **å›¾æ ‡**: Lucide React
- **HTTP å®¢æˆ·ç«¯**: Axios

### å¤–éƒ¨æœåŠ¡é›†æˆ
- **Whisper AI** - è¯­éŸ³è¯†åˆ«å’Œå­—å¹•ç”Ÿæˆ
- **ç™¾åº¦ç¿»è¯‘ API** - å­—å¹•ç¿»è¯‘
- **DeepSeek API** - AI ç¿»è¯‘å’Œå…ƒæ•°æ®ç”Ÿæˆ
- **Bilibili API** - è§†é¢‘ä¸Šä¼ å’Œç”¨æˆ·ä¿¡æ¯
- **è…¾è®¯äº‘ COS** - æ–‡ä»¶å­˜å‚¨

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
bili_up_backend/
â”œâ”€â”€ cmd/                    # å‘½ä»¤è¡Œå·¥å…·
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ internal/               # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±å’Œæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ auth.go        # è®¤è¯æ¥å£
â”‚   â”‚   â”œâ”€â”€ category.go    # åˆ†ç±»æ¥å£
â”‚   â”‚   â”œâ”€â”€ routes.go      # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ upload.go      # ä¸Šä¼ æ¥å£
â”‚   â”œâ”€â”€ bilibili/          # Bç«™ API å°è£…
â”‚   â”‚   â”œâ”€â”€ auth.go        # è®¤è¯å’Œç”¨æˆ·ä¿¡æ¯
â”‚   â”‚   â””â”€â”€ upload.go      # è§†é¢‘ä¸Šä¼ 
â”‚   â”œâ”€â”€ chain_task/        # ä»»åŠ¡é“¾å¤„ç†
â”‚   â”‚   â””â”€â”€ chain_task_handler.go
â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ config.go
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ services/      # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task_step_service.go    # ä»»åŠ¡æ­¥éª¤æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ video_service.go        # è§†é¢‘æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ types/         # ç±»å‹å®šä¹‰
â”‚   â”‚       â””â”€â”€ app_config.go
â”‚   â””â”€â”€ handler/           # HTTP å¤„ç†å™¨
â”‚       â”œâ”€â”€ auth_handler.go      # è®¤è¯å¤„ç†
â”‚       â”œâ”€â”€ video_handler.go     # è§†é¢‘å¤„ç†
â”‚       â””â”€â”€ ...
â”œâ”€â”€ pkg/                   # å¯é‡ç”¨åŒ…
â”‚   â”œâ”€â”€ appauth/          # åº”ç”¨è®¤è¯ â­ NEW
â”‚   â”‚   â”œâ”€â”€ client.go     # è®¤è¯å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ manager.go    # å‘¨æœŸæ£€æŸ¥ç®¡ç†å™¨
â”‚   â”œâ”€â”€ bilibili/         # Bç«™ API
â”‚   â”‚   â””â”€â”€ auth.go       # ç”¨æˆ·ä¿¡æ¯è·å–
â”‚   â””â”€â”€ store/            # æ•°æ®å­˜å‚¨
â”‚       â””â”€â”€ model/
â”‚           â”œâ”€â”€ task_step.go    # ä»»åŠ¡æ­¥éª¤æ¨¡å‹
â”‚           â”œâ”€â”€ video.go        # è§†é¢‘æ¨¡å‹
â”‚           â””â”€â”€ ...
â”œâ”€â”€ biliup-rs/            # Rust ä¸‹è½½å’Œä¸Šä¼ å·¥å…·
â”‚   â””â”€â”€ crates/
â”‚       â”œâ”€â”€ biliup/       # æ ¸å¿ƒåº“
â”‚       â””â”€â”€ biliup-cli/   # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ docs/                 # æ–‡æ¡£
â”‚   â”œâ”€â”€ APP_AUTH_SETUP.md      # åº”ç”¨è®¤è¯è®¾ç½®æŒ‡å—
â”‚   â”œâ”€â”€ APP_AUTH_TESTING.md    # åº”ç”¨è®¤è¯æµ‹è¯•æŒ‡å—
â”‚   â””â”€â”€ APP_AUTH_SUMMARY.md    # åº”ç”¨è®¤è¯åŠŸèƒ½æ€»ç»“
â”œâ”€â”€ config.toml           # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ config.app_auth.example.toml  # è®¤è¯é…ç½®ç¤ºä¾‹
â”œâ”€â”€ test_app_auth.sh      # è®¤è¯ API æµ‹è¯•è„šæœ¬
â””â”€â”€ main.go               # åº”ç”¨å…¥å£
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

> ğŸ“š **å®Œæ•´æ„å»ºæŒ‡å—**: è¯·æŸ¥çœ‹ [BUILD_GUIDE.md](./BUILD_GUIDE.md) äº†è§£è¯¦ç»†çš„æ„å»ºå’Œéƒ¨ç½²è¯´æ˜ã€‚

### å¿«é€Ÿæ„å»ºï¼ˆä¸€é”®æ‰“åŒ…å‰ç«¯+åç«¯ï¼‰

```bash
cd bili-up-api
make build
./bili-up-api-server
```

è¿™å°†è‡ªåŠ¨ï¼š
1. æ„å»º Next.js å‰ç«¯å¹¶å¯¼å‡ºé™æ€æ–‡ä»¶
2. å°†å‰ç«¯åµŒå…¥åˆ° Go äºŒè¿›åˆ¶ä¸­
3. ç¼–è¯‘ç”Ÿæˆå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶

è®¿é—® `http://localhost:8096` å³å¯ä½¿ç”¨å®Œæ•´çš„å‰åç«¯åŠŸèƒ½ã€‚

### 1. ç¯å¢ƒè¦æ±‚

- Go 1.19+
- MySQL 8.0+ / PostgreSQL / SQLite
- Node.js 18+ (ç”¨äºæ„å»ºå‰ç«¯)
- Rust 1.70+ (biliup-rsï¼Œå¯é€‰)

### 2. é…ç½®æ•°æ®åº“

```sql
CREATE DATABASE bili_up CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 3. é…ç½®æ–‡ä»¶

å¤åˆ¶å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```bash
cp config.toml.example config.toml
```

ç¼–è¾‘ `config.toml`ï¼š

```toml
listen = ":8096"
environment = "development"
debug = true
FileUpDir = "/path/to/media"

[database]
  type = "mysql"
  host = "localhost"
  port = 3306
  username = "root"
  password = "your_password"
  database = "bili_up"

# è…¾è®¯äº‘ COS é…ç½®
[TenCosConfig]
  Enabled = true
  CosBucketURL = "https://your-bucket.cos.region.myqcloud.com"
  CosSecretId = "your_secret_id"
  CosSecretKey = "your_secret_key"
  CosRegion = "ap-guangzhou"
  CosBucket = "your-bucket"

# ç™¾åº¦ç¿»è¯‘é…ç½®
[BaiduTransConfig]
  enabled = true
  app_id = "your_app_id"
  secret_key = "your_secret_key"

# DeepSeek é…ç½®
[DeepSeekTransConfig]
  enabled = true
  api_key = "your_api_key"
  model = "deepseek-chat"
  endpoint = "https://api.deepseek.com"

```

### 4. ç¼–è¯‘è¿è¡Œ

```bash
# å®‰è£…ä¾èµ–
go mod download

# ç¼–è¯‘
go build -o bili_up_backend main.go

# è¿è¡Œ
./bili_up_backend
```

---

## ğŸ“– API æ–‡æ¡£

### è§†é¢‘ç®¡ç†

#### è·å–è§†é¢‘åˆ—è¡¨
```http
GET /api/v1/videos
```

#### è·å–è§†é¢‘è¯¦æƒ…ï¼ˆå«ä»»åŠ¡æ­¥éª¤ï¼‰
```http
GET /api/v1/videos/:id
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "title": "è§†é¢‘æ ‡é¢˜",
    "description": "è§†é¢‘æè¿°",
    "cover_url": "å°é¢URL",
    "status": "completed",
    "task_steps": [
      {
        "step_name": "download_video",
        "step_order": 1,
        "status": "completed",
        "duration": 120,
        "can_retry": false
      },
      // ... å…¶ä»–æ­¥éª¤
    ]
  }
}
```

#### é‡è¯•ä»»åŠ¡æ­¥éª¤
```http
POST /api/v1/videos/:id/steps/:stepName/retry
```

#### è·å–è§†é¢‘æ–‡ä»¶åˆ—è¡¨
```http
GET /api/v1/videos/:id/files
```

### è®¤è¯ç›¸å…³

#### è·å–ç™»å½•äºŒç»´ç 
```http
GET /api/v1/auth/qrcode
```

#### è·å–äºŒç»´ç å›¾ç‰‡
```http
GET /api/v1/auth/qrcode/image/:authCode
```

#### è½®è¯¢ç™»å½•çŠ¶æ€
```http
POST /api/v1/auth/poll
Body: {"auth_code": "xxx"}
```

#### æ£€æŸ¥ç™»å½•çŠ¶æ€
```http
GET /api/v1/auth/status
```

#### è·å–ç”¨æˆ·ä¿¡æ¯
```http
GET /api/v1/auth/userinfo
```

#### ç™»å‡º
```http
POST /api/v1/auth/logout
```

---



## ğŸ¯ ä»»åŠ¡å¤„ç†æµç¨‹

### 6æ­¥å¤„ç†é“¾

1. **download_video** - ä¸‹è½½è§†é¢‘
   - æ”¯æŒå¤šå¹³å°ï¼ˆBç«™ã€æŠ–éŸ³ã€YouTube ç­‰ï¼‰
   - è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ¸…æ™°åº¦
   - ä¿å­˜åˆ°æœ¬åœ°æˆ–äº‘å­˜å‚¨

2. **generate_subtitles** - ç”Ÿæˆå­—å¹•
   - ä½¿ç”¨ Whisper AI è¯­éŸ³è¯†åˆ«
   - è‡ªåŠ¨æ–­å¥å’Œæ—¶é—´è½´
   - æ”¯æŒå¤šè¯­è¨€è¯†åˆ«

3. **translate_subtitles** - ç¿»è¯‘å­—å¹•
   - ç™¾åº¦ç¿»è¯‘æˆ– DeepSeek AI
   - ä¿ç•™å­—å¹•æ ¼å¼å’Œæ—¶é—´è½´
   - æ”¯æŒå¤šè¯­è¨€ç¿»è¯‘

4. **generate_metadata** - ç”Ÿæˆå…ƒæ•°æ®
   - AI åˆ†æè§†é¢‘å†…å®¹
   - ç”Ÿæˆæ ‡é¢˜ã€æè¿°ã€æ ‡ç­¾
   - ç¬¦åˆ Bç«™ SEO è§„èŒƒ

5. **upload_to_bilibili** - ä¸Šä¼ è§†é¢‘
   - åˆ†ç‰‡ä¸Šä¼ æ”¯æŒå¤§æ–‡ä»¶
   - è‡ªåŠ¨é‡è¯•æœºåˆ¶
   - å®æ—¶è¿›åº¦åé¦ˆ

6. **upload_subtitles** - ä¸Šä¼ å­—å¹•
   - æ”¯æŒåŒè¯­å­—å¹•
   - è‡ªåŠ¨å…³è”è§†é¢‘
   - SRT/ASS æ ¼å¼æ”¯æŒ

### ä»»åŠ¡çŠ¶æ€

- `pending` - ç­‰å¾…æ‰§è¡Œ
- `running` - æ‰§è¡Œä¸­
- `completed` - å·²å®Œæˆ
- `failed` - å¤±è´¥
- `skipped` - è·³è¿‡

---

## ğŸ§ª æµ‹è¯•

### è¿è¡Œå•å…ƒæµ‹è¯•
```bash
go test ./...
```

### API æµ‹è¯•

ä½¿ç”¨æä¾›çš„æµ‹è¯•è„šæœ¬ï¼š

```bash
# æµ‹è¯•åº”ç”¨è®¤è¯
./test_app_auth.sh

# æµ‹è¯•è§†é¢‘ä¸Šä¼ ï¼ˆéœ€è¦å…ˆç™»å½•ï¼‰
curl http://localhost:8096/api/v1/videos

# æµ‹è¯•è®¤è¯çŠ¶æ€
curl http://localhost:8096/api/v1/auth/status
```

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### videos è¡¨
```sql
CREATE TABLE videos (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  title VARCHAR(255),
  description TEXT,
  cover_url VARCHAR(512),
  file_path VARCHAR(512),
  status VARCHAR(50),
  bilibili_bvid VARCHAR(50),
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

### task_steps è¡¨
```sql
CREATE TABLE task_steps (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  video_id BIGINT,
  step_name VARCHAR(100),
  step_order INT,
  status VARCHAR(50),
  start_time TIMESTAMP,
  end_time TIMESTAMP,
  duration INT,
  error_msg TEXT,
  result_data JSON,
  can_retry BOOLEAN,
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  FOREIGN KEY (video_id) REFERENCES videos(id)
);
```

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯**: `Error 1045: Access denied`

**è§£å†³**:
1. æ£€æŸ¥ `config.toml` ä¸­çš„æ•°æ®åº“é…ç½®
2. ç¡®è®¤ MySQL æœåŠ¡æ­£åœ¨è¿è¡Œ
3. éªŒè¯ç”¨æˆ·åå’Œå¯†ç 

### é—®é¢˜2: Bç«™ç™»å½•å¤±è´¥

**é”™è¯¯**: äºŒç»´ç è¿‡æœŸæˆ–æ— æ³•æ‰«æ

**è§£å†³**:
1. åˆ·æ–°é¡µé¢é‡æ–°è·å–äºŒç»´ç 
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. ç¡®è®¤ Bç«™è´¦å·çŠ¶æ€æ­£å¸¸

### é—®é¢˜3: è§†é¢‘ä¸Šä¼ å¤±è´¥

**é”™è¯¯**: ä¸Šä¼ è¶…æ—¶æˆ–ä¸­æ–­

**è§£å†³**:
1. æ£€æŸ¥ç½‘ç»œé€Ÿåº¦
2. å°è¯•å‡å°è§†é¢‘æ–‡ä»¶å¤§å°
3. æŸ¥çœ‹ Bç«™è´¦å·æ˜¯å¦æœ‰ä¸Šä¼ æƒé™
4. æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸ

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

## ğŸ“„ è®¸å¯è¯

MIT License

---
